---
import Layout from '../../layouts/Layout.astro';
import { contentfulClient } from '../../lib/contentful';
import type { Project } from '../../lib/contentful';
import { documentToHtmlString } from '@contentful/rich-text-html-renderer';
import { BLOCKS } from '@contentful/rich-text-types';

let project;
const { slug } = Astro.params;

const options = {
  renderNode: {
    [BLOCKS.EMBEDDED_ASSET]: ({
      data: {
        target: { fields },
      },
    }) =>
      `<Image src="${fields.file.url}" height="${fields.file.details.image.height / 10}" width="${fields.file.details.image.width / 10}" alt="${fields.description}"/>`,
  },
};

try {
  const data = await contentfulClient.getEntries<Project>({
    content_type: 'project',
    'fields.slug': slug,
  });
  const { title, date, image, content } = data.items[0].fields;
  project = {
    title,
    date: new Date(date).toLocaleDateString(),
    image: image.fields.file.url,
    content: documentToHtmlString(content, options),
  };
} catch (error) {
  return Astro.redirect('/404');
}
---

<Layout>
  <div class="headerText">
    <h1>{project?.title}</h1>
    <h2>{project?.date}</h2>
  </div>
  <img src={project?.image} />
  <article set:html={project?.content} />
</Layout>

<style>
  img {
    width: 100vw;
    height: 100vh;
    z-index: 0;
    position: absolute;
    top: 0;
    left: 0;
  }

  article {
    display: block;
    position: absolute;
    top: 105vh;
  }

  .headerText {
    display: flex;
    position: absolute;
    flex-direction: column;
    z-index: 1;
    color: white;
    bottom: 0;
  }
</style>
